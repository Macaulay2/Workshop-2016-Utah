\documentclass[12pt]{amsart}
%   \overfullrule=5pt
\usepackage[active]{srcltx}
\usepackage{calc,amssymb,amsthm,amsmath,amscd, eucal,ulem}
\usepackage{alltt}
\usepackage[left=1.35in,top=1.25in,right=1.35in,bottom=1.25in]{geometry}
\synctex=1
%\usepackage{mathtools}
\RequirePackage[dvipsnames,usenames]{color}
\let\mffont=\sf
\normalem
\input{kmacros3.sty}
\input{mabliautoref.sty}
\input{xy}
\xyoption{all}
\usepackage{tikz}
%\usepackage{pdfsync}
%
%

\numberwithin{equation}{theorem}
\def\ff{{\bf f}}
\def\XX{{\bf X}}
\def\YY{{\bf Y}}

%\renewcommand{\thefootnote}{\fnsymbol{footnote}}
\newcommand{\D}{\displaystyle}
\newcommand{\til}{\widetilde}
\newcommand{\ol}{\overline}
\newcommand{\F}{\mathbb{F}}
\DeclareMathOperator{\E}{E}
\renewcommand{\:}{\colon}
\newcommand{\eg}{{\itshape e.g.} }
\renewcommand{\m}{\mathfrak{m}}
\renewcommand{\n}{\mathfrak{n}}
\newcommand{\Tt}{{\mathfrak{T}}}
\newcommand{\calC}{\mathcal{C}}
\newcommand{\RamiT}{\mathcal{R_{T}}}
\DeclareMathOperator{\edim}{edim}
\DeclareMathOperator{\length}{length}
\DeclareMathOperator{\monomials}{monomials}
\DeclareMathOperator{\Fitt}{Fitt}
\DeclareMathOperator{\depth}{depth}
\newcommand{\Frob}[2]{{#1}^{1/p^{#2}}}
\newcommand{\Frobp}[2]{{(#1)}^{1/p^{#2}}}
\newcommand{\FrobP}[2]{{\left(#1\right)}^{1/p^{#2}}}
\newcommand{\extends}{extends over $\Tt${}}
\newcommand{\extension}{extension over $\Tt${}}
\DeclareMathOperator{\DIV}{Div}
%\DeclareMathOperator{\Tor}{Tor}
%\DeclareMa
%\DeclareMathOperator{\Ann}{Ann}
%\DeclareMathOperator{\height}{ht}
%\DeclareMathOperator{\rank}{rank}
%\DeclareMathOperator{\ord}{ord}
%\DeclareMathOperator{\ker}{ker}
%\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\sspan}{span}
%\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\homgp}{Hom}
%\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\socle}{socle}
%\DeclareMathOperator{\id}{id}
%\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\Ass}{Ass}
\DeclareMathOperator{\Exc}{exc}
\DeclareMathOperator{\Newt}{Newt}
\DeclareMathOperator{\sheafhom}{\scr{H}{\kern -2pt om}}
\DeclareMathOperator{\soc}{socle}
\DeclareMathOperator{\pd}{pd}
\DeclareMathOperator{\ffield}{frac} %fraction field
\DeclareMathOperator{\Projfnc}{Proj} %proj functor
%\DeclareMathOperator{\sn}{sn}
%\usepackage{showkeys}

%\usepackage[left=1.25in,top=1.25in,right=1.25in,bottom=1.25in]{geometry}
\usepackage{fullpage}

\usepackage{setspace}
% \singlespacing, \doublespacing, \onehalfspacing,
%\spacing{1.3}
\usepackage{hyperref}
% \url{http://www.umich.edu/~kevtuck}, \href{mailto:kevtuck@umich.edu}{kevtuck@umich.edu}

\usepackage{enumerate}
%\begin{enumerate}[(1.)]

\usepackage{graphicx}
% \includegraphics[width=2in]{Pics/picture.pdf}

\usepackage[all,cmtip]{xy}
%\ar[r] to
%\ar@{|->}[r] mapsto
%\ar@{-}[r]} line
%\ar@{^{(}->}[r] injective arrow
%\ar@{->>}[r] surjective arrow
%\ar@{.>}[r] just the head of an arrow
%\ar@{-->}[r] dashed arrow
%\ar@{=>}[r] double lined arrow
%\ar@{~>}[r] squigly arrow
%\ar@{=}[r] equals
%
% superscripts and subscripts add labels to the arrows
%
%Commutative Diagram
%
%\[  \xymatrix{
%%
%A    \ar[d]    \ar[r]    &     B   \ar[d]   \\
%C    \ar[r]                 &     D
%%
%} \]
%
%
%Short Exact Sequence
%
%\[  \xymatrix{
%%
%0 \ar[r] &   A   \ar[r] &   B   \ar[r] &   C   \ar[r] & 0
%%
%} \]
%

\usepackage{verbatim}

\theoremstyle{theorem}
\newtheorem*{mainthm}{Main Theorem}
\newtheorem*{mainthma}{Main Theorem A}
\newtheorem*{mainthmb}{Main Theorem B}
\newtheorem*{mainthmc}{Main Theorem C}
\newtheorem*{atheorem}{Theorem}

%The todo box!
\def\todo#1{\textcolor{Mahogany}%
{\footnotesize\newline{\color{Mahogany}\fbox{\parbox{\textwidth-15pt}{\textbf{todo:
} #1}}}\newline}}

%What is going on?  Why isn't \O a script O?!?
\renewcommand{\O}{\mathcal O}

\begin{document}
\title{RationalMaps, a package for Macaulay2}
\author{C.J. Bott}
\author{S. Hamid Hassanzadeh}
\author{Karl Schwede}
\author{Daniel Smolkin}
\address{Department of Mathematics\\ University of Utah\\ Salt Lake City\\ UT 84112}
\email{schwede@math.utah.edu}
\address{Department of Mathematics\\ University of Utah\\ Salt Lake City\\ UT 84112}
\email{smolkin@math.utah.edu}


\thanks{The third named author was supported in part by the NSF FRG Grant DMS \#1265261/1501115 and NSF CAREER Grant DMS \#1252860/1501102}
\thanks{The fourth named author was supported in part by the NSF FRG Grant DMS \#1265261/1501115 and NSF CAREER Grant DMS \#1252860/1501102}


%  \subjclass[2010]{14F18, 13A35, 14B05}

\maketitle

\begin{abstract}

\end{abstract}



\section{Introduction}

\cite{DoriaHassanzadehSimisBirationality}

\section{Base Loci}
We begin with the problem of computing the base locus of a map to projective space. Let $X$ be a projective variety over $k$ and let $F: X \to \P_k^m$ be a rational map of $X$ to projective space. Then we can choose some representative $(f_0, \cdots, f_m)$ of $F$, where each $f_i$ is the $i^{\textrm{th}}$ coordinate of $F$. A priori, each $f_i$ is in $K = \ffield R$, where $R$ is the coordinate ring of $X$. However, we can get another representative of $F$ by clearing denominators. (Note this does not enlarge the base locus of $F$ since $F$ is undefined wherever the denominator of the of the $f_i$s vanishes.) Thus we can assume that $f_i\in R$ for all $i$, and that all the $f_i$ are homogenous of the same degree.   

In this setting, one might naively think that the map $F$ is undefined exactly when all of the $f_i$ vanish, and thus the base locus is the vanishing set of the ideal $(f_0, \cdots, f_m)$. However, this can yield a base locus that's too big. For example, suppose $X = \Projfnc k[x, y, z]$ and $F$ is the rational map represented by $(x^2y, x^2z, xyz)$. Then the vanishing locus of the ideal $(x^2y, x^2z, xyz)$ is the union of the line $\left\{ x = 0 \right\}$ with the point $(1:0:0)$. However, the same rational map is given by $(xy, xz, yz)$ since these two representations agree where $\left\{ x\neq 0 \right\}$ (see \cite[I.4]{Hartshorne}), and the vanishing locus of $(xy, xz, yz)$ is just the three points $\left\{ (1:0:0), (0:1:0), (0:0:1) \right\}$. 

Thus, to find the base locus of a rational map, we must consider all possible representations of the map and find where none of them are defined. To do this, we use a lemma of Aron Simis \cite[Proposition 1.1]{SimisCremona}. We restate the lemma here for convenience's sake: 

% take a presentation of I
% ker $\vp^t$ is Hom(I,R)
% vectors of this correpond to reps of $I$
% so take the ideal generated by these vectors
% 

\begin{lemma}
  Let $F: X \dashrightarrow \P^m$ be a rational map and let $\textbf{f} = \left\{ f_0, \dots, f_m \right\}$ be a representative of $F$ with $f_i\in R$ homogenous of degree $d$ for all $i$. Set $I  = (f_0, \cdots, f_m)$. Then the set of such representatives of $F$ corresponds bijectively to the homogenous vectors in the rank 1 graded $R$-module $\homgp_R(I, R)$.
  \label{lemma:repsOfRatMap}
\end{lemma}
%I can probably omit this...
\begin{proof}
  Suppose that $(f'_0, \cdots, f'_m)$ is another such representative of $F$. Then there is some $h\in K$ such that $hf_i = f'_i$ for all $i$. In particular, we have that each $hf_i \in R$ for each $i$, and so $h\in \left( R :_K I \right)$. Further, it's clear that each homogenous element of $\left( R :_K I \right)$ gives another representative of $F$. Thus the set of representatives of $F$ is $\left\{ (h f_0, \cdots, hf_m)\mid h\in \left( R :_K I \right) \right\}$. It's a standard fact that $\homgp_R(I, R) = \left\{ x\mapsto hx \mid h\in (R :_K I) \right\}$, giving us the desired result. 
\end{proof}

%and I can probably just refer to simis for this...
Now, in the setting of \ref{lemma:repsOfRatMap}, let
  \[
    \bigoplus_s R(d_s) \xrightarrow{\varphi} R(-d)^m \xrightarrow{[f_0, \cdots, f_m]} I \to 0 
  \]
be a free resolution of $I$. Then we get
\[
  0 \to \homgp_R(I, R) \to \left( R(-d)^{m+1} \right)^\vee \xrightarrow{\varphi^t} \left( \bigoplus_s R(d_s) \right)^\vee 
\]
where $\varphi^t$ is the transpose of $\varphi$ and $R^\vee$ is the dual module of $R$. Thus, we get that $\homgp_R(I,R) \cong \ker \varphi^t$, and so each representative of $F$ corresponds to a vector in $\ker \varphi^t$. The correspondence takes a representative $(hf_0, \cdots, hf_m)$ to the map that multiplies vectors in $R^{m+1}$ by $[hf_0, \cdots, hf_m]$ on the left.

The base locus of $F$ is the intersection of the sets $V(f^i_0, \cdots, f^i_m)$ as $\mathbf{f}^i = (f^i_0, \cdots, f^i_m)$ ranges over all the representatives of $F$. The above implies that this is the same as the intersection of the sets $V(w^i_0,\cdots, w^i_m)$ as $\mathbf{w}^i = (w^i_0, \cdots, w^i_m)$ ranges over the vectors in $\ker \varphi^t$. Now, given any $a, f, g\in R$, we have $V(af) \supseteq V(f)$ and $V(f + g) \supseteq V(f)\cap V(g)$. Thus, it's enough to take a generating set $\mathbf w^1, \cdots, \mathbf w^n$ of $\ker \varphi^t$  and take the intersection over this generating set. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In summary, if we're given a representation $(f_0, \cdots, f_m)$ of a rational map to projective space, we compute its base locus by:
\begin{enumerate}
  \item finding $M = \ker \varphi^t$, where $\varphi$ is a presentation matrix for $I$,
  \item fixing a generating set $\mathbf w^1, \cdots, \mathbf w^n$ for $M$ as an $R$-module, and
  \item taking the ideal generated by all the entries of all of the $\mathbf w^i$.
\end{enumerate}
The base locus of $F$ is then the variety cut out by this ideal, though our function \verb=baseLocusOfMap= just returns this ideal:

\begin{verbatim}
i1 : loadPackage "RationalMaps"

o1 = RationalMaps

o1 : Package

i2 : R = QQ[x,y,z]

o2 = R

o2 : PolynomialRing

i3 : f = {x^2*y, x^2*z, x*y*z}

       2    2
o3 = {x y, x z, x*y*z}

o3 : List

i4 : baseLocusOfMap(f)

o4 = ideal (y*z, x*z, x*y)

o4 : Ideal of R


\end{verbatim}

 If the \verb=SaturateOutput= option is left on, our function will return the saturation of this ideal:

\begin{verbatim}
i5 : baseLocusOfMap({x,y,z})

o5 = ideal 1

o5 : Ideal of R

i6 : baseLocusOfMap({x,y,z}, SaturateOutput=>false)

o6 = ideal (x, y, z)

o6 : Ideal of R    
\end{verbatim}

This is desirable because, for any ideal $I$, the saturation of $I$ is the largest ideal cutting out the same projective variety as $I$ \cite[II.5 exercise whatever]{Hartshorne}. Thus, by saturating the output, we get a canonical ideal that cuts out the base locus. 

\section{Birationality and Inverse Maps}
A rational map $\mathfrak{F}:X\subseteq \P^n\dasharrow \P^m$ between projective
spaces is defined by $m+1$ forms $\ff=\{f_0,\ldots f_m\}$
of the same degree in $n+1$ variables not all vanishing.
The idea of looking at the syzygies of the forms $\ff$ to detect the geometric properties of  $\mathfrak{F}$ goes
back to the work of Hulek-Katz-Schreyer (\cite{HulekKatzSchreyer}) in the case
where $m=n$ and $X=\P^n$. In \cite{RussoSimisComposito}  this method has been developed by Russo and Simis 
to a greater extent when $X=\P^n$ and $m\geq n$. Simis pushed the method further to the study
of general rational maps between two integral projective schemes in
arbitrary characteristic by an extended ideal-theoretic method
emphasizing the role of the Rees algebra associated to the ideal
generated by $\ff$ (\cite{SimisCremona}).

In a recent work Doria-Hassanzadeh-Simis \cite{DoriaHassanzadehSimisBirationality} applied the above mentioned 
 techniques from Rees algebra to study the birationality of  $\mathfrak{F}$. 
Let $\ff=\{f_0,\ldots,f_m\}\subset R$ be an ordered set of forms of the same degree,
where $R$, the coordinate ring of $X$,  denotes a standard graded $k$-algebra, with $k$ a field and $\dim R\geq 1$.
Thus, one has a presentation $R\simeq k[x_0,\ldots, x_n]=k[\XX]/\mathfrak{a}$ with $k[\XX]=k[X_0,\ldots, X_n]$
standard graded and $\mathfrak{a}$ a homogeneous ideal.
Let $R[\YY]=R[Y_0,\ldots,Y_m]$ be a polynomial ring over $R$ with the standard bigrading
where $\deg(X_i)=(1,0)$ and $\deg(Y_j)=(0,1)$.
Since $\ff$ is generated in a fixed degree, the Rees algebra
$${\mathcal R}_R((\ff)):=R\oplus I\oplus I^2\oplus \cdots \simeq R[It]\subset R[t]$$
is a standard bigraded $k$-algebra. Mapping $Y_j\mapsto f_jt$ yields
a presentation $R[\YY]/\mathcal{J}\simeq {\mathcal R}_R((\ff))$, with $\mathcal{J}$ a bihomogeneous {\em presentation
ideal}.
$\mathcal{J}$ depends only on the rational map defined by $\ff$
and not on this particular representative.
Write
$${\mathcal J}=\bigoplus_{(p,q)\in \mathbb{N}^2} {\mathcal J}_{(p,q)},$$
where ${\mathcal J}_{(p,q)}$ denotes the $k$-vector space of forms of bidegree $(p,q)$.



For birationality, the following bihomogeneous piece is  important:
$${\mathcal J}_{1,*}:=\bigoplus_{r\in\mathbb{N}} {\mathcal J}_{1,q}$$
with ${\mathcal J}_{1,q}$ denoting the bigraded piece of ${\mathcal J}$ spanned by the forms of bidegree
 $(1,q)$ for all $q\geq 0$. Now, a form of bidegree $(1,*)$ can be written as $\sum_{i=0}^n Q_i(\YY)\,x_i$, for suitable homogeneous $Q_i(\YY)\in k[\YY]\subset R[\YY]$
of the same degree.
Since $\YY$ are indeterminates over $R$, two such representations of the same form imply a syzygy of $\{x_0,\ldots,x_n\}$
with coefficients in $k$. Thus the representation is unique  up to $k$-linear dependency
of $\{x_0,\ldots,x_n\}$,  i.e., up to elements of ${\mathfrak a}_1$.

In particular, if the {\sc embedding dimension} of $R$ -- i.e., the $k$-vector space dimension
$\edim (R):=\dim_k(R_1)=n+1-\dim_k {\mathfrak a}_1$ -- is $n+1$ then every such form has a unique expression.

Next, one can pick a minimal set of generators of the ideal $({\mathcal J}_{1,*})$ consisting of a finite number
of forms of bidegree $(1,q)$, for various $q$'s.
Let $\{P_1,\ldots,P_s\}\subset k[\XX,\YY]$ denote liftings of these biforms and let $\{\ell_1,\ldots,\ell_r\}\subset k[\XX]$ be  a $k$-vector space
basis of ${\mathfrak a}_1$.
Consider the Jacobian matrix of the polynomials $\{\ell_1,\ldots,\ell_r, P_1,\ldots,P_s\}$ with respect to $\XX$, a matrix with entries in $k[\YY]$.
Write $\psi$ for the corresponding matrix over $S=k[\YY]/{\mathfrak b}$. This matrix is called  called the {\bf weak Jacobian dual matrix}  associated to
the given set of generators of $({\mathcal J}_{1,*})$.
Note that a weak Jacobian matrix $\psi$ is not uniquely defined due to the lack of uniqueness in the expression of
an individual form and to the choice of bihomogeneous generators. Even though it is shown in \cite[Lemma 2.13]{DoriaHassanzadehSimisBirationality} that  If the weak Jacobian matrix associated  to a set of bihomogeneous minimal generators of
$({\mathcal J}_{1,*})$ has rank over $S$ then the weak Jacobian matrix associated to any other
set of bihomogeneous minimal generators of
$({\mathcal J}_{1,*})$ has  rank over $S$ and the two ranks coincide.

%========================================================================
The main theorem of loc.cit. is the following: 
\begin{theorem} \label{T birationality}Let $X\subseteq \P^n$ be non-degerated, then $\mathfrak{F}$ is birational if and only if ${\rm rank}(\psi)=\edim(R)-1(=n).$
Moreover
\begin{enumerate}
\item[{\rm (i)}] A rational $(n+1)$-datum in
$S$ representing the inverse map is given by the coordinates of any homogeneous vector of positive degree
in the {\rm (}rank one{\rm )} null space of $\psi$ over $S$ for which these coordinates generate an ideal containing
a regular element.

\item[{\rm (ii)}] If further $R$ is a domain, a rational $(n+1)$-datum as in {\rm (i)}
can be taken to be the set of the {\rm (}ordered, signed{\rm )} $(\edim(R)-1)$-minors
of an arbitrary $(\edim(R)-1)\times \edim(R)$ submatrix of $\psi$ of rank $\edim(R)-1$.
\end{enumerate}

\end{theorem}
As it is expected, the most expensive part to apply this theorem is computing the Rees ideal ${\mathcal J}$. In Package {\textsc RationalMaps} we use {\textsc ReesStrategy} to compute the Rees equations. The algorithm is the standard elimination order, however we do not use the package {\textsc ReesAlgebra} since verifying birationality according to Theorem \ref{T birationality}, we only need to compute a special part of the Rees ideal namely elements of first degree $1$, this idea is applied in the {\textsc SimisStrategy}. More precisely, if the given map $\mathfrak{F}$ is birational after computing the Rees equations upto a certain degree $(1,N)$ where $N$ is a sufficiently big number, the jacobian dual rank attains its maximum value $\edim(R)-1$; so that we will be able to compute the inverse map.  The dark side of {\textsc SimisStrategy} is that if $\mathfrak{F}$ is not birational that desired number $N$ cannot be found and the process never ends. For this reason,  we consider the {\textsc HybridStrategy}  between {\textsc ReesStrategy} and {\textsc SimisStrategy}. {\textsc HybridLimit} is an option to change  {\textsc SimisStrategy} to  \textsc{ReesStrategy} if the computations upto degree $(1, \textsc{HybridLimit})$ do not lead to   ${\rm rank}(\psi)=\edim(R)-1$. 
The default value for {\textsc HybridLimit} is $15$. The change from  {\textsc SimisStrategy} to  {\textsc ReesStrategy} is in such a way that the computed  generators of   Rees ideal  in { \textsc SimisStrategy} are not lost and the program just tries to compute other generators of Rees ideals while keeping the found generators.  Yet, still there is another method to compute Rees ideal which is {\textsc SaturationStrategy} in this option the whole Rees ideal is computing by saturating the  ideal of definition of Symmetric algebra with respect to a non-zero element in $R$ (We assume $R$ to be a domain). This Strategy appears to be slower in some examples however one may improve this option by stoping the computation of the saturation in a certain step.

Computing the inverse map is the most important part of this program, which is done by function {\sc inverseOfMap}. According to Theorem \ref{T birationality} there are two way to compute the inverse $(1)$ to find any syzygy of the jacobian dual matrix and $(2)$ to find a sub-matrix of $\psi$ of rank $\edim(R)-1$. Either ways has its own benefit, case $(1)$ is quite fast in many cases, however case $(2)$ is very useful if the rank of the jacobian dual matrix  $\psi$ is relatively smaller than the degree of the entries of $\psi$. Choosing each of these options is controlled by option {\sc MinorsCount}. Setting it to zero will mean no minors are checked and the inverse of map is computed by looking at the syzygies of $\psi$.  If it is left as null (the default), the functions will try to make an educated guess as to how big to make this, depending on varieties you are working with.......

\section{Embeddings}

\bibliographystyle{skalpha}
\bibliography{MainBib.bib}
\end{document}


